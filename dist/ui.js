"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");require("core-js/modules/es.array.includes"),require("core-js/modules/es.array.iterator"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Main=exports.CompleteMessage=exports.SearchInput=exports.HighlightedText=void 0;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_path=require("path"),_util=require("util"),_fsExtra=require("fs-extra"),_react=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_figures=require("figures"),_clipboardy=_interopRequireDefault(require("clipboardy")),_ink=require("ink"),_inkTextInput=_interopRequireDefault(require("ink-text-input"));const getFileContent=(0,_util.promisify)(_fsExtra.readFile),getDirectoryContent=(0,_util.promisify)(_fsExtra.readdir),writeContent=(0,_util.promisify)(_fsExtra.writeFile),getStat=(0,_util.promisify)(_fsExtra.stat),{min,max}=Math,HighlightedText=({children:a,bold:b,re:c})=>{const[d]=a.match(c)||[],e=d?a.indexOf(d):0,{length:f}=d||a;return""===d?_react.default.createElement(_ink.Color,{dim:!0,bold:b},a):_react.default.createElement(_ink.Box,null,_react.default.createElement(_ink.Color,{dim:!0,bold:b},a.substring(0,e)),_react.default.createElement(_ink.Color,{bold:!0,cyan:!0},d),_react.default.createElement(_ink.Color,{dim:!0,bold:b},a.substring(e+f)))};exports.HighlightedText=HighlightedText;const SearchInput=({value:a,path:b,onChange:c})=>_react.default.createElement(_ink.Box,{marginBottom:1,marginTop:1},_react.default.createElement(_ink.Color,{dim:!0},b,"/"),_react.default.createElement(_ink.Color,{bold:!0,cyan:!0},_react.default.createElement(_inkTextInput.default,{value:a,onChange:c})));exports.SearchInput=SearchInput;const CompleteMessage=({value:a,copyFileContent:b=!1,outputFileName:c=""})=>{const d=b?_react.default.createElement(_ink.Color,{bold:!0,cyan:!0}," ",a," content "):_react.default.createElement(_ink.Color,{bold:!0,cyan:!0}," \u201C",a,"\u201D ");return _react.default.createElement(_ink.Box,{marginBottom:1},_react.default.createElement(_ink.Box,{paddingLeft:2},c?_react.default.createElement(_react.Fragment,null,_react.default.createElement(_ink.Color,null,"\u21B3 Saved"),_react.default.createElement(_ink.Color,{bold:!0,cyan:!0}," ",a),_react.default.createElement(_ink.Color,null," to ",process.cwd(),"/"),_react.default.createElement(_ink.Color,{bold:!0,cyan:!0},c)):_react.default.createElement(_react.Fragment,null,_react.default.createElement(_ink.Color,null,"\u21B3 Copied"),d,_react.default.createElement(_ink.Color,null,"to clipboard!"))))};exports.CompleteMessage=CompleteMessage;const Main=({flags:a,input:b,stdin:c})=>{const[d=process.cwd()]=b,{filenameOnly:e,limit:f,removeExtension:g,absolute:h,content:i,output:j}=a,{exit:k}=(0,_react.useContext)(_ink.AppContext),[l,m]=(0,_react.useState)(d),[n,o]=(0,_react.useState)(""),[p,q]=(0,_react.useState)([]),[r,s]=(0,_react.useState)([]),[t,u]=(0,_react.useState)(0),[v,w]=(0,_react.useState)(void 0),[x,y]=(0,_react.useState)(void 0),z=()=>{o(""),q(r),u(0)};return(0,_react.useEffect)(()=>{function a(){return b.apply(this,arguments)}function b(){return b=(0,_asyncToGenerator2.default)(function*(){const a=yield getDirectoryContent(d);q(a),s(a)}),b.apply(this,arguments)}a()},[]),c||(0,_ink.useInput)(/*#__PURE__*/function(){var a=(0,_asyncToGenerator2.default)(function*(a,b){const c=a=>[].concat(g?a=>(0,_path.parse)(a).name:[],e?[]:a=>(0,_path.join)((h?_path.resolve:_path.relative)(d,l),a)).reduce((a,b)=>b(a),a);if(b.return){const a=p[t],b=(0,_path.join)(l,a);if((yield getStat(b)).isDirectory()){const a=yield getDirectoryContent(b);m(b),o(""),q(a),s(a),u(0)}else{if(i&&g)y({message:"Cannot use --remove-extension/-r AND --content/-c options at the same time!"});else{const b=c(a);try{const a=i||j?yield getFileContent(b,"utf8"):b;yield _clipboardy.default.write(a),j&&writeContent(j,a)}catch(a){y(a)}w(b)}k()}}if(((a,b)=>"i"===a&&b.ctrl)(a,b)&&u(t+1===p.length?0:t+1),b.downArrow&&u(min(t+1,p.length-1)),b.upArrow){const{length:a}=p;u(t>a?a-1:max(t-1,0))}});return function(){return a.apply(this,arguments)}}()),c?_react.default.createElement(_ink.Color,{dim:!0},"handle input from stdin..."):_react.default.createElement(_react.Fragment,null,x&&_react.default.createElement(_ink.Box,{margin:1,flexDirection:"row"},_react.default.createElement(_ink.Color,{red:!0},"ERROR: "),_react.default.createElement(_ink.Text,null,x.message)),v?x||_react.default.createElement(CompleteMessage,{value:v,copyFileContent:i,outputFileName:j}):_react.default.createElement(_ink.Box,{flexDirection:"column"},_react.default.createElement(SearchInput,{value:n,path:l,onChange:a=>{const b=["[","]","(",")","\\","*","+","?"];if((a=>b.every(b=>!a.startsWith(b))&&!a.includes("\t"))(a)){let b;try{b=new RegExp(a)}catch(a){y({message:"Invalid regular expression"}),z()}b&&(y(void 0),o(a),q(r.filter(a=>b.test(a))))}t>p.length&&u(p.length-1)}}),p.slice(0,f).map((a,b)=>_react.default.createElement(_ink.Box,{key:b,marginLeft:1},b===t?_react.default.createElement(_ink.Color,{bold:!0,cyan:!0},_figures.play," "):_react.default.createElement(_ink.Color,null,"  "),_react.default.createElement(HighlightedText,{re:n,bold:t===b},a))),p.length>f&&_react.default.createElement(_ink.Box,{marginLeft:1},_react.default.createElement(_ink.Color,{dim:!0},"  ..."))))};exports.Main=Main,HighlightedText.propTypes={children:_propTypes.default.node,bold:_propTypes.default.bool,re:_propTypes.default.string},SearchInput.propTypes={value:_propTypes.default.string,path:_propTypes.default.string,onChange:_propTypes.default.func},CompleteMessage.propTypes={copyFileContent:_propTypes.default.bool,outputFileName:_propTypes.default.string,value:_propTypes.default.string},Main.propTypes={flags:_propTypes.default.object,input:_propTypes.default.array,stdin:_propTypes.default.string};var _default=Main;exports.default=_default;